---

import { getEntry } from "astro:content";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { siteConfig, profileConfig } from "../config";

const friendsPost = await getEntry("spec", "friends");

if (!friendsPost) {
	throw new Error("Friends page content not found");
}

// Parse friends data from markdown content
const friendsContent = friendsPost.body;
const friendRegex =
	/####\s+([^\n]+)\n\s*-\s*(https?:\/\/[^\n]+)\n\s*-\s*(https?:\/\/[^\n]+)\n\s*-\s*([^\n]+)/g;
const friends = [];
let match;

while ((match = friendRegex.exec(friendsContent)) !== null) {
	friends.push({
		name: match[1].trim(),
		url: match[2].trim(),
		avatar: match[3].trim(),
		description: match[4].trim(),
	});
}
---
<MainGridLayout title="友链" description="我的朋友们，优秀的博客推荐及友情链接申请。">
    <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
        <div class="card-base z-10 px-9 py-6 relative w-full ">
            <h1 class="text-2xl font-bold mb-6">我的朋友们</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {friends.map((friend) => (
                    <a 
                        href={friend.url} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="friend-card flex flex-col items-center p-6 rounded-[var(--radius-large)] bg-white/70 dark:bg-gray-800/70 hover:bg-white/90 dark:hover:bg-gray-800/90 transition-all duration-300 shadow-sm hover:shadow-md"
                    >
                        <div class="relative w-24 h-24 mb-4">
                            <img 
                                src={friend.avatar} 
                                alt={friend.name} 
                                class="w-full h-full object-cover rounded-full border-2 border-[var(--primary)]/30"
                            />
                        </div>
                        
                        <h3 class="text-xl font-bold mb-2 text-center">{friend.name}</h3>
                        
                        <p class="text-gray-600 dark:text-gray-300 text-center text-sm line-clamp-2">
                            {friend.description}
                        </p>
                    </a>
                ))}
            </div>

            <!-- 友链申请部分 -->
            <div class="mt-12 p-6 bg-white/70 dark:bg-gray-800/70 rounded-[var(--radius-large)] shadow-sm">
                <h2 class="text-xl font-bold mb-4">友链申请</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-4">
                    欢迎交换友链！请按照以下格式发送邮件至我的邮箱，我会尽快处理您的申请。
                </p>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">我的信息：</h3>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg font-mono text-sm overflow-x-auto select-text">
                        <p>网站名称：{siteConfig.title}</p>
                        <p>网站地址：https://undf.top/</p>
                        <p>网站头像：{profileConfig.avatar}</p>
                        <p>网站描述：{siteConfig.subtitle}</p>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">申请格式：</h3>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg font-mono text-sm overflow-x-auto">
                        <p>网站名称：[您的网站名称]</p>
                        <p>网站地址：[您的网站URL]</p>
                        <p>网站头像：[您的网站头像URL]</p>
                        <p>网站描述：[您的网站描述]</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">申请邮箱：</h3>
                    <a 
                        href="mailto:weiekko@gamil.com?subject=友链申请&body=网站名称：%0A网站地址：%0A网站头像：%0A网站描述：%0A" 
                        class="text-[var(--primary)] hover:underline font-medium"
                    >
                        weiekko@gamil.com
                    </a>
                </div>
                
                <div class="text-gray-500 dark:text-gray-400 text-sm">
                    <p>注意事项：</p>
                    <ul class="list-disc list-inside mt-1">
                        <li>请确保您的网站内容健康，无违法违规信息</li>
                        <li>请先添加我的友链，再申请交换</li>
                        <li>申请后我会在1-3个工作日内处理</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</MainGridLayout>
