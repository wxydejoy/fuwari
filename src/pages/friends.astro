---

import { getEntry } from "astro:content";
import MainGridLayout from "../layouts/MainGridLayout.astro";

const friendsPost = await getEntry("spec", "friends");

if (!friendsPost) {
	throw new Error("Friends page content not found");
}

// Parse friends data from markdown content
const friendsContent = friendsPost.body;
const friendRegex = /####\s+([^\n]+)\n\s*-\s*(https?:\/\/[^\n]+)\n\s*-\s*(https?:\/\/[^\n]+)\n\s*-\s*([^\n]+)/g;
const friends = [];
let match;

while ((match = friendRegex.exec(friendsContent)) !== null) {
	friends.push({
		name: match[1].trim(),
		url: match[2].trim(),
		avatar: match[3].trim(),
		description: match[4].trim(),
	});
}
---
<MainGridLayout title="友链" description="我的朋友们">
    <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
        <div class="card-base z-10 px-9 py-6 relative w-full ">
            <h1 class="text-2xl font-bold mb-6">我的朋友们</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {friends.map((friend) => (
                    <a 
                        href={friend.url} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="friend-card flex flex-col items-center p-6 rounded-[var(--radius-large)] bg-white/70 dark:bg-gray-800/70 hover:bg-white/90 dark:hover:bg-gray-800/90 transition-all duration-300 shadow-sm hover:shadow-md"
                    >
                        <div class="relative w-24 h-24 mb-4">
                            <img 
                                src={friend.avatar} 
                                alt={friend.name} 
                                class="w-full h-full object-cover rounded-full border-2 border-[var(--primary)]/30"
                            />
                        </div>
                        
                        <h3 class="text-xl font-bold mb-2 text-center">{friend.name}</h3>
                        
                        <p class="text-gray-600 dark:text-gray-300 text-center text-sm line-clamp-2">
                            {friend.description}
                        </p>
                    </a>
                ))}
            </div>
        </div>
    </div>
</MainGridLayout>
