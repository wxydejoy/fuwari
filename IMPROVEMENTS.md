# é¡¹ç›®æ”¹è¿›æ€»ç»“

æœ¬æ–‡æ¡£è®°å½•äº†æœ¬æ¬¡å¯¹é¡¹ç›®è¿›è¡Œçš„å„é¡¹æ”¹è¿›ã€‚

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ âœ¨

**æ–‡ä»¶**: `src/utils/logger.ts`

- åˆ›å»ºäº†ç»Ÿä¸€çš„æ—¥å¿—å·¥å…·ï¼ŒåŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è‡ªåŠ¨ç¦ç”¨è°ƒè¯•æ—¥å¿—ï¼ˆ`debug`ã€`info`ï¼‰ï¼Œä»…ä¿ç•™è­¦å‘Šå’Œé”™è¯¯æ—¥å¿—
- æä¾›äº†ç±»å‹å®‰å…¨çš„æ—¥å¿—æ¥å£

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { logger } from "@utils/logger";

logger.debug("è°ƒè¯•ä¿¡æ¯"); // ä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡º
logger.info("ä¿¡æ¯");      // ä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡º
logger.warn("è­¦å‘Š");      // æ‰€æœ‰ç¯å¢ƒéƒ½è¾“å‡º
logger.error("é”™è¯¯", error); // æ‰€æœ‰ç¯å¢ƒéƒ½è¾“å‡º
```

### 2. URL éªŒè¯å’Œå®‰å…¨å·¥å…· ğŸ”’

**æ–‡ä»¶**: `src/utils/url-validator.ts`

- å®ç°äº† URL éªŒè¯å’Œæ¸…ç†åŠŸèƒ½
- æ”¯æŒåè®®ç™½åå•éªŒè¯
- æ”¯æŒä¸»æœºç™½åå•ï¼ˆå¯é€‰ï¼‰
- æä¾›äº†æ‰¹é‡éªŒè¯å’Œè¿‡æ»¤åŠŸèƒ½

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { isValidUrl, filterValidUrls } from "@utils/url-validator";

// éªŒè¯å•ä¸ª URL
if (isValidUrl(url)) {
  // ä½¿ç”¨ URL
}

// æ‰¹é‡è¿‡æ»¤
const validUrls = filterValidUrls(urlArray);
```

### 3. é”™è¯¯å¤„ç†æ”¹è¿› ğŸ›¡ï¸

**æ–‡ä»¶**: `src/utils/error-handler.ts`

- åˆ›å»ºäº†ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å·¥å…·
- æä¾›äº†è‡ªå®šä¹‰é”™è¯¯ç±» `AppError`
- å®ç°äº†å®‰å…¨æ‰§è¡Œå‡½æ•°ï¼ˆ`safeExecute`ã€`safeExecuteSync`ï¼‰
- æä¾›äº†é”™è¯¯åŒ…è£…å™¨ï¼ˆ`withErrorHandling`ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
import { safeExecute, AppError, ErrorType } from "@utils/error-handler";

// å®‰å…¨æ‰§è¡Œå¼‚æ­¥å‡½æ•°
const result = await safeExecute(
  async () => fetchData(),
  fallbackValue,
  "Failed to fetch data"
);

// åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯
throw new AppError(ErrorType.NETWORK, "Network request failed", originalError);
```

### 4. ä»£ç æ¸…ç† ğŸ§¹

**å·²æ›´æ–°çš„æ–‡ä»¶**:
- `src/components/misc/ImageWrapper.astro` - ä½¿ç”¨ loggerï¼Œæ”¹è¿›ç±»å‹å®‰å…¨
- `src/pages/photography.astro` - ä½¿ç”¨ logger å’Œ URL éªŒè¯ï¼Œæ”¹è¿›é”™è¯¯å¤„ç†
- `src/components/Search.svelte` - æ¡ä»¶åŒ– console.log
- `src/pages/search-data.json.ts` - æ¡ä»¶åŒ–é”™è¯¯æ—¥å¿—
- `src/layouts/Layout.astro` - ç§»é™¤/æ¡ä»¶åŒ–è°ƒè¯•æ—¥å¿—
- `src/pages/archive.astro` - ç§»é™¤è°ƒè¯•æ—¥å¿—
- `src/plugins/rehype-component-github-card.mjs` - æ¡ä»¶åŒ–æ—¥å¿—

**æ”¹è¿›**:
- æ‰€æœ‰ `console.log` åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¢«ç¦ç”¨æˆ–æ¡ä»¶åŒ–
- ä½¿ç”¨ç»Ÿä¸€çš„ logger å·¥å…·
- æ”¹è¿›äº†é”™è¯¯å¤„ç†ï¼Œä½¿ç”¨ try-catch å’Œ fallback å€¼

### 5. ç±»å‹å®‰å…¨æ”¹è¿› ğŸ“

**æ–‡ä»¶**: `src/utils/content-utils.ts`

- ç§»é™¤äº†éšå¼çš„ `any` ç±»å‹
- ä½¿ç”¨ `Record<string, number>` æ›¿ä»£ `{ [key: string]: number }`
- æ”¹è¿›äº†æ—¥æœŸæ¯”è¾ƒé€»è¾‘
- æ·»åŠ äº†ç©ºå€¼æ£€æŸ¥

**æ”¹è¿›**:
- æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- æ›´å¥½çš„ IDE ç±»å‹æç¤º
- å‡å°‘è¿è¡Œæ—¶é”™è¯¯

### 6. CI/CD å·¥ä½œæµä¼˜åŒ– ğŸš€

**æ–‡ä»¶**: `.github/workflows/astro.yml`

- åˆ›å»ºäº† `scripts/process-posts.js` è„šæœ¬ï¼Œä½¿ç”¨ Node.js å¤„ç†æ–‡ç« æ ¼å¼è½¬æ¢
- æ›¿æ¢äº†ä¸å¥å£®çš„ `sed` å‘½ä»¤
- æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- æ”¹è¿›äº†æ­¥éª¤é¡ºåºï¼Œå…ˆå®‰è£…ä¾èµ–å†å¤„ç†æ–‡ç« 

**æ–‡ä»¶**: `.github/workflows/update-photography.yml`

- æ”¹è¿›äº† URL æå–çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›´å®‰å…¨
- æ·»åŠ äº† URL æ ¼å¼éªŒè¯
- æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œè¶…æ—¶è®¾ç½®
- æ”¹è¿›äº† Git æäº¤æ¶ˆæ¯ï¼ˆæ·»åŠ  `[skip ci]` é¿å…å¾ªç¯è§¦å‘ï¼‰

### 7. æ‘„å½±é¡µé¢æ€§èƒ½ä¼˜åŒ– âš¡

**æ–‡ä»¶**: `src/pages/photography.astro`

- ä½¿ç”¨ `Promise.allSettled` å¤„ç†å¯èƒ½å¤±è´¥çš„å›¾ç‰‡è·å–
- æ·»åŠ äº† URL éªŒè¯å’Œè¿‡æ»¤
- æ”¹è¿›äº†é”™è¯¯å¤„ç†ï¼Œå•ä¸ªå›¾ç‰‡å¤±è´¥ä¸å½±å“å…¶ä»–å›¾ç‰‡
- æ·»åŠ äº†ç±»å‹å®šä¹‰

**æ”¹è¿›**:
- æ„å»ºæ—¶æ›´ç¨³å®šï¼Œä¸ä¼šå› ä¸ºå•ä¸ªå›¾ç‰‡å¤±è´¥è€Œä¸­æ–­
- è‡ªåŠ¨è¿‡æ»¤æ— æ•ˆ URL
- æ›´å¥½çš„é”™è¯¯æ—¥å¿—

### 8. ç¯å¢ƒå˜é‡ç®¡ç† ğŸ“‹

**æ–‡ä»¶**: `.env.example`

- åˆ›å»ºäº†ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
- æä¾›äº†é…ç½®æ¨¡æ¿å’Œè¯´æ˜

## ğŸ“Š æ”¹è¿›ç»Ÿè®¡

- âœ… åˆ›å»ºæ–°å·¥å…·æ–‡ä»¶: 4 ä¸ª
- âœ… æ›´æ–°ç°æœ‰æ–‡ä»¶: 10+ ä¸ª
- âœ… æ”¹è¿› CI/CD å·¥ä½œæµ: 2 ä¸ª
- âœ… ç§»é™¤/æ¡ä»¶åŒ– console.log: 15+ å¤„
- âœ… ç±»å‹å®‰å…¨æ”¹è¿›: å¤šå¤„

## ğŸ”„ åç»­å»ºè®®

è™½ç„¶æœ¬æ¬¡æ”¹è¿›å·²ç»å®Œæˆï¼Œä½†ä»¥ä¸‹æ–¹é¢å¯ä»¥è€ƒè™‘è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

1. **æµ‹è¯•è¦†ç›–**: æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **æ€§èƒ½ç›‘æ§**: æ·»åŠ æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ªï¼ˆå¦‚ Sentryï¼‰
3. **æ–‡æ¡£**: ä¸ºå·¥å…·å‡½æ•°æ·»åŠ  JSDoc æ³¨é‡Š
4. **ä¾èµ–æ›´æ–°**: å®šæœŸæ›´æ–°ä¾èµ–å¹¶æ£€æŸ¥å®‰å…¨æ¼æ´
5. **ç¼“å­˜ç­–ç•¥**: ä¸ºæœç´¢æ•°æ®å’Œå›¾ç‰‡æ·»åŠ ç¼“å­˜æœºåˆ¶

## ğŸ“ ä½¿ç”¨æŒ‡å—

### ä½¿ç”¨æ–°çš„æ—¥å¿—å·¥å…·

```typescript
import { logger } from "@utils/logger";

// å¼€å‘ç¯å¢ƒä¼šè¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¼š
logger.debug("è°ƒè¯•ä¿¡æ¯");
logger.info("ä¿¡æ¯");

// æ‰€æœ‰ç¯å¢ƒéƒ½ä¼šè¾“å‡º
logger.warn("è­¦å‘Š");
logger.error("é”™è¯¯", error);
```

### ä½¿ç”¨ URL éªŒè¯

```typescript
import { isValidUrl, filterValidUrls } from "@utils/url-validator";

// åœ¨ url-validator.ts ä¸­é…ç½®å…è®¸çš„ä¸»æœº
const ALLOWED_HOSTS = [
  "img.undf.top",
  "imgchr.com",
  // æ·»åŠ æ›´å¤šå…è®¸çš„åŸŸå
];
```

### ä½¿ç”¨é”™è¯¯å¤„ç†

```typescript
import { safeExecute, AppError, ErrorType } from "@utils/error-handler";

// å®‰å…¨æ‰§è¡Œå¯èƒ½å¤±è´¥çš„å‡½æ•°
const data = await safeExecute(
  async () => await fetchData(),
  defaultValue,
  "Failed to fetch data"
);
```

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æ”¹è¿›æ˜¾è‘—æå‡äº†é¡¹ç›®çš„ï¼š
- **ä»£ç è´¨é‡**: ç»Ÿä¸€çš„æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- **ç±»å‹å®‰å…¨**: ç§»é™¤ anyï¼Œä½¿ç”¨ä¸¥æ ¼ç±»å‹
- **å®‰å…¨æ€§**: URL éªŒè¯å’Œæ¸…ç†
- **å¯ç»´æŠ¤æ€§**: æ›´å¥½çš„ä»£ç ç»„ç»‡å’Œé”™è¯¯å¤„ç†
- **ç¨³å®šæ€§**: æ”¹è¿›çš„ CI/CD å’Œé”™è¯¯å¤„ç†

æ‰€æœ‰æ”¹è¿›éƒ½å·²å®Œæˆå¹¶é€šè¿‡äº†ä»£ç æ£€æŸ¥ï¼
